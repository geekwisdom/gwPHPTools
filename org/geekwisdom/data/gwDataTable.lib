<?php
class gwDataColumn
{
private $item=array();

function __construct ($ary=null)
{
if ($ary !== null)
{
$this->item=$ary;
}
}

function set ($name,$val)
{
$this->item[$name]=$val;
}

function get ($name)
{
$a=$this->item;
$r=$a[$name];
return $r;
}

function toArray()
{
return $this->item;
}

}

class gwDataTable
{
private $data=array();
private $xml="";
private $tablename="root";

function __construct ($_xmlinfo = "",$_tablename="root")
{
//construct the $data Array  from xmo
$this->tablename=$_tablename;
}

function find($whereclause)
{
$data=$this->toXml();
$xml = @simplexml_load_string($data);
$result=$xml->xpath("/xmlDS/" . $this->tablename ."[" .$whereclause . "]"); 
$json = json_encode($result);
$array = json_decode($json,TRUE);
$retval=new gwDataTable("",$this->tablename);
for ($i=0;$i<count($array);$i++)
 {
 $retval->add(new gwDataColumn($array[$i]));
 }
return $retval;
//print_r($result);
//die();

}

function loadXml($xmlstring)
{
//$this->data = array();
$xml = simplexml_load_string($xmlstring);
$json = json_encode($xml);
$array = json_decode($json,TRUE);
$keys = array_keys($array);
$tablename=$keys[0];
$table=array_pop($array);
$this->tablename=$tablename;
for ($i=0;$i<count($table);$i++)
 {
 $row=new gwDataColumn($table[$i]);
 $this->add($row);
 }

}

function getRow($rownum)
{
//return $data at row $rownum
return $this->data[$rownum];
}

function add($rowitem)
{
//add a new $rowitem of data to the row (should have same "properites as other ows 'someohw'
if ($this->validatearray($rowitem))
 {
 array_push($this->data,$rowitem);
 return true;
 }
return false;
}

function length()
{
return count($this->data);
}
function validatearray($rowitem)
{
//verify the properties/columns of the array are consistent before insert
return true;
}
function remove($rownum)
{
//remove $rownum item from the table

}

function insert($rowitem,$rownum)
{
//insert rowitem to rownum
}

function array_to_xml( $dataColumn, &$xml_data ) {

    foreach( $dataColumn as $key => $value ) {
        if( is_numeric($key) ){
          //  $key = 'item'.$key; //dealing with <0/>..<n/> issues
              $key = $this->tablename;
        }
        if( is_array($value) ) {
            $subnode = $xml_data->addChild($key);
            $this->array_to_xml($value, $subnode);
        } else {
            $xml_data->addChild("$key",htmlspecialchars("$value"));
        }
     }
}

function toArray()
{
$newary = array();
for ($i=0;$i<count($this->data);$i++)
 {
  $item=$this->data[$i];
  $newary[$i]=$item->toArray();
 }
return $newary;
}

function toXml()
{
//output result as xml / set xml
$xml_data = new SimpleXMLElement('<?xml version="1.0" ?><xmlDS></xmlDS>');
$data = $this->data;
$n = $this->toArray();
$this->array_to_xml($n,$xml_data);
$result = $xml_data->asXML();
$xmlDocument = new DOMDocument('1.0');
$xmlDocument->preserveWhiteSpace = false;
$xmlDocument->formatOutput = true;
$xmlDocument->loadXML($result);
$retval = $xmlDocument->saveXML();
return $retval;
}
}
?>
